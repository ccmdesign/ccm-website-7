# Component: `ccm-card`

**Source:** This specification is based on the principles outlined in Heydon Pickering's ["Inclusive Components: Cards"](https://inclusive-components.design/cards/).

## 1. Core Philosophy

The `ccm-card` component should be a robust, accessible, and progressively enhanced teaser for linked content (like a blog post or case study). It must prioritize a logical document structure for assistive technologies while providing an intuitive, clickable interface for all users.

## 2. Props

The component should accept the following props:

- `href` (String, required): The URL for the card's primary link.
- `title` (String, required): The main title for the card, which will also serve as the primary link text.
- `description` (String, optional): A brief summary or description.
- `imageUrl` (String, optional): The URL for the card's image.
- `imageAlt` (String, required if `imageUrl` is present): The alt text for the image. If the image is purely decorative, this should be an empty string (`""`).
- `meta` (String, optional): Small metadata text, like an author's name or date.
- `showCta` (Boolean, default: `false`): If `true`, displays a "Read More" visual cue.

## 3. Markup Specification (HTML Structure)

The component must render the following semantic structure. The root element **must** be a `<li>`.

### 3.1. Source Order

The DOM order is critical for accessibility. Elements must be ordered as follows, even if their visual presentation is different:

1.  **Text Content Wrapper** (`div`):
    1.  **Title/Heading** (`h2` or other appropriate heading level):
        - Contains the primary `<a>` tag.
        - The `href` attribute of the `<a>` tag is bound to the `href` prop.
        - The text content is the `title` prop.
        - If `showCta` is `true`, this `<a>` tag must have an `aria-describedby` attribute pointing to the ID of the CTA `span`.
    2.  **Description** (`p`):
        - Contains the `description` prop content.
    3.  **CTA** (`span`):
        - Rendered only if `showCta` is `true`.
        - Must have a unique `id` for the `aria-describedby` relationship. This ID can be generated by slugifying the title.
        - Must have `aria-hidden="true"` to prevent screen readers from announcing it as a separate, non-interactive element.
        - Text content should be "Read More" or similar.
    4.  **Meta** (`small` or `p`):
        - Contains the `meta` prop content.
2.  **Image Wrapper** (`div`):
    1.  **Image** (`img`):
        - `src` is bound to `imageUrl`.
        - `alt` is bound to `imageAlt`.

### 3.2. Example Structure

```html
<li class="ccm-card">
  <!-- Text content must come first in the DOM -->
  <div class="card-text">
    <h2>
      <a href="/path-to-post" aria-describedby="cta-card-design-woes">
        Card design woes
      </a>
    </h2>
    <p>Ten common pitfalls to avoid when designing card components.</p>
    <span class="cta" aria-hidden="true" id="cta-card-design-woes">Read more</span>
    <small>By Heydon Pickering</small>
  </div>

  <!-- Image comes after text in the DOM -->
  <div class="card-image">
    <img src="/path/to/image.png" alt="A decorative illustration.">
  </div>
</li>
```

## 4. Behavior and Interactivity

### 4.1. Clickability

The entire card should be clickable, not just the title link. This provides a larger, more user-friendly target area.

- A click event listener must be attached to the root `<li>` element.
- This event handler should programmatically trigger a `click()` on the primary `<a>` tag inside the `<h2>`.
- The handler must check that the event target is not the primary link itself to avoid a double-firing event loop due to event bubbling.
- To allow for text selection, the handler should detect the time between `mousedown` and `mouseup`. If the duration exceeds a threshold (e.g., 200ms), the click action should be suppressed.

### 4.2. Example Script (Composition API)

```javascript
import { ref, onMounted } from 'vue';

const cardElement = ref(null);
const primaryLink = ref(null);
let down, up;

onMounted(() => {
  if (cardElement.value) {
    primaryLink.value = cardElement.value.querySelector('h2 a');

    cardElement.value.onmousedown = () => {
      down = +new Date();
    };

    cardElement.value.onmouseup = (e) => {
      up = +new Date();
      if ((up - down) < 200) {
        if (primaryLink.value && e.target !== primaryLink.value) {
          primaryLink.value.click();
        }
      }
    };
  }
});
```

## 5. Styling (CSS)

### 5.1. Visual Order vs. Source Order

- The card container (`<li>`) should use `display: flex` and `flex-direction: column`.
- The text content wrapper (`<div class="card-text">`) should have `order: 1` to appear visually after the image.
- The image wrapper (`<div class="card-image">`) should have `order: 0` (or simply come before the text wrapper visually by default if no `order` is specified on it) to appear at the top. This correctly separates the visual presentation from the accessible DOM order where text comes first.


### 5.2. Focus States

- When the primary link is focused, a clear visual focus indicator must be present.
- If `showCta` is `true`, `:focus-within` can be used on the card or title wrapper to apply focus styles to the decorative CTA `span` when the link is focused, making it clear which element is active.

### 5.3. Touch Targets

- All interactive elements, especially the primary link, should have sufficient padding to be easily tappable on touch devices.

## 6. Accessibility (A11y) Recap

- **Landmarks**: Cards must be grouped within a `<ul>` or `<ol>`.
- **Headings**: The card title must be a heading (`<h2>`, `<h3>`, etc.) to facilitate navigation for screen reader users.
- **Link Text**: Link text is descriptive and unique (e.g., the post title), not generic ("Read more").
- **Images**: `alt` text is mandatory. Use `""` for decorative images.
- **ARIA**: `aria-hidden` and `aria-describedby` are used correctly to create a seamless experience for the optional CTA, avoiding redundant tab stops and providing clear context.
- **Source Order**: The logical content order is preserved in the DOM, with visual changes handled by CSS.
